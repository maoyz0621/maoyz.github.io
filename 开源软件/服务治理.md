# 服务治理



## 方法级别：

### QPS限制：

**RateLimiter**，超过QPS阀值的调用直接降级或抛出异常，自定义限流周期以及周期内流量阈值

- limitForPeriod  周期内流量阈值

- limitRefreshPeriod  周期时间

> 支持配置文件更新

### 并发数限制

**ConcurrentLimiter**，基于信号量实现（业界通常采用基于线程池的隔离术）

- threshold  并发数

> 并发数支持配置文件更新

### 熔断

某个方法的错误率超过阀值时，后续调用会执行降级方法或抛出异常。一段时间后，允许一定量的请求去探测原方法，如果错误率低于阈值则判定原方法已经恢复，后续请求正常调用；否则继续执行降级方法。

基于有限状态机来实现

- 关闭     服务正常

- 打开     服务异常，降级或抛出异常

- 半开     进入打开状态一段时间后，熔断器检查服务是否恢复

  ringBufferSizeInClosedState=100，ringBufferSizeInHalfOpenState=10，waitDurationInOpenState=60，failureRateThreshold=50为例分析熔断器的状态变化：熔断器默认为关闭状态，当最近100次请求的失败率大于或等于50%，熔断器打开，此后所有请求均被降级；60s之后熔断器自动切换到半开状态，此时允许10个请求通过，如果这10个请求的失败率低于50%，熔断器切换到关闭状态，否则熔断器再次切换到打开状态。
  
  

- ringBufferSizeInClosedState    熔断器关闭状态下大小

- ringBufferSizeInHalfOpenState  熔断器半开状态下大小

- waitDurationInOpenState   熔断器从打开到半开等待时长

- failureRateThreshold    失败率阈值

- ignoreExceptions     不纳入失败总数的异常类型

- predicateStrategy     熔断策略（异常、超时、异常+超时）

- maxSpendTimeMs    方法最大耗时

### 降级

降级到指定方法、降级到指定值、降级到指定异常

### 重试



## 参数级别：

### QPS限制

### 并发数限制

### 熔断



### 人工降级

强制切换熔断器到打开状态，此后所有对原始方法的调用都会执行降级方法，直到手动关闭该功能(默认关闭)。

### 异步方法治理



## 接口分组

## 全局配置



